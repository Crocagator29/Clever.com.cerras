<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JustStudy CE</title>
    <link rel="icon" type="image/x-icon" href="/assets/img/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <style>
        :root {
            --background: #36393f;
            --sidebar: #2f3136;
            --chat-bg: #36393f;
            --secondary-bg: #2c2f33;
            --text-color: #dcddde;
            --accent-color: #7289da;
            --border-color: #202225;
            --input-bg: #202225;
        }

        body {
            margin: 0;
            font-family: "Poppins", sans-serif;
            color: var(--text-color);
            background-color: var(--background);
            overflow: hidden;
        }

        .maincontent {
            display: flex;
            flex-direction: row;
            height: 100vh;
        }

        .leftsidecontent {
            width: 4vw;
            background-color: var(--sidebar);
            display: flex;
            flex-direction: column;
            align-items: center; 
            padding-top: 1vw;
            box-sizing: border-box;
            overflow-y: scroll;
            scrollbar-width: none;
            overflow-x:hidden;
        }
        .rightsidecontent{
            width: 11vw;
            background-color: var(--sidebar);
            display: flex;
            flex-direction: column;
            align-items: center; 
            padding-top: 1vw;
            box-sizing: border-box;
            overflow-y: scroll;
            scrollbar-width: none;
            overflow-x:hidden;
        }
        .chatcontent {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--chat-bg);
            position: relative;
            scrollbar-width: none;
        }

        .content {
            overflow-y: auto;
            overflow-x: hidden;
            flex: 1;
            scrollbar-width: none;
            padding: 1vw;
            box-sizing: border-box;
        }

        .bottombar {
            display: flex;
            background-color: var(--secondary-bg);
            padding: 0.5vw;
        }

        .textinput {
            flex: 1 1 auto;
            height: 2vw;
            font-size: 1vw;
            background-color: var(--input-bg);
            border: none;
            color: var(--text-color);
            padding: 0.3vw 0.5vw;
            outline: none;
            border-radius: 0.2vw;
        }

        .leftsidecontent-inputfield {
            background-color: var(--input-bg);
            border: none;
            padding: 0.4vw;
            margin: 0.4vw;
            width: 13vw;
            color: var(--text-color);
            outline: none;
            border-radius: 0.2vw;
        }

        .content-bt {
            background-color: var(--accent-color);
            border: none;
            padding: 0.6vw;
            margin: 0.4vw;
            width: 14vw;
            color: #fff;
            cursor: pointer;
            border-radius: 0.2vw;
            font-size: 1vw;
        }

        .content-bt:hover {
            opacity: 0.9;
        }

        .white-text {
            font-size: 1vw;
            margin-left: 1.5vw;
            padding: 0.4vw;
            color: var(--text-color);
        }

        .textbox {
            background-color: var(--secondary-bg);
            padding: 0.7vw;
            border-radius: 0.4vw;
            margin: 0.4vw;
            max-width: 83vw;
            width: auto;
            font-size: 1vw;
            word-break: break-all;
        }

        .textbox-name {
            font-size: 0.9vw;
            margin-left: 0.4vw;
            padding: 0.4vw;
            color: var(--accent-color);
        }
        .bg {
            position: fixed;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
            z-index: -1;
            background:linear-gradient(120deg, rgb(48, 0, 223), rgb(22, 0, 104));
        }
        .leftsidecontent-icon-container {
            width: 3vw;
            height: 3vw;
            justify-content: center;
            align-items: center;
            margin-bottom: 1vw;
        }
        .server-icon-container {
            width: 3vw;
            height: 3vw;
            justify-content: center;
            align-items: center;
            margin-bottom: 1vw;
            backdrop-filter: blur(1.6vw);
            -webkit-backdrop-filter: blur(1vw);
            background-color: rgba(116, 116, 116, 0.2);
            border-radius: 2vw;
            transition: all 0.3s ease;
        }
        .server-icon-container:hover {
            border-radius: 0.5vw;
            background-color: rgba(125, 255, 166, 0.581);
        }
        .leftsidecontent-icon {
            transition: all 0.4s ease; 
            border-radius: 2vw;
            border: #7289da00 0.15vw solid;
        }
        .leftsidecontent-icon:hover {
            border: #ffc400 0.15vw solid;
            border-radius: 0.5vw;
        }
        .popup {
            display: none;
            position: fixed;
            background: rgb(27, 27, 27);
            border: 0.01vw solid rgb(107, 107, 107);
            border-radius: 0.5vw;
            padding: 0.5vw;
            color: white;
            font-size: 0.7vw;
            transform: translateY(20%);
            transition: all 0.2s ease;
            pointer-events: none;
            box-shadow: 0.1vw 0.1vw 0.2vw rgba(0, 0, 0, 0.5);
        }
        .userinfo-container{
            height: 3vw;
            width: 10vw;
            display: flex; 
            align-items: center; 
            justify-content: space-between;
        }
        .usericon-container{
            width: 3vw;
            height: 3vw;
            margin-bottom: 2vw;
            margin-top: 2vw;
            border-radius: 2vw;
            overflow: hidden;
            justify-content: center;
            align-items: center;
            display: flex;
            border: var(--accent-color) 0.15vw solid;
        }
        .usericon{
            border-radius: 2vw;
        }
        .AddServerPopup{
            width: 20vw;
            height: 27vw;
            background-color: var(--sidebar);
            border-radius: 1vw;
            position:fixed;
            left: 50%;
            top: 50%;
            display: none;
            flex-direction: column;
            align-items: center; 
            transform: translate(-50%,-50%);
            transition: all 0.1s ease;
            opacity: 0;
            font-family: comfortaa , sans-serif;
        }
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            opacity: 0;
            display: none;
        }
        .ShowOverlayAnim{
            animation: ShowOverlay ease-in 0.2s forwards;
        }
        .HideOverlayAnim{
            animation: HideOverlay ease-out 0.2s forwards;
        }
        @keyframes ShowOverlay {
            0% {
                opacity: 0;
                display: none;
            }
            100% {
                display: block;
                opacity: 0.5;
            }
        }
        @keyframes HideOverlay {
            0% {
                opacity: 0.5;
                display: block;
            }
            100% {
                opacity: 0;
                display: none;
            }
        } 
        .smoothshow{
            animation: AddServerPopupShow ease-in 0.15s forwards;
        }
        .smoothhide{
            animation: AddServerPopupHide ease-out 0.15s forwards;
        }
        @keyframes AddServerPopupShow {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }
        @keyframes AddServerPopupHide {
            0% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        } 
        .popuptext{
            font-size: 2vw;
            color:white;
        }
        .custominput{
            flex: 0 1 auto;
            height: 2vw;
            font-size: 1vw;
            background-color: var(--input-bg);
            border: none;
            color: var(--text-color);
            padding: 0.3vw 0.5vw;
            outline: none;
            border-radius: 0.2vw;
            margin-top: 0.4vw;
            margin-bottom: 0.4vw;
        }
        .LoginBox{
            width: 30vw;
            height: 20vw;
            background-color: var(--sidebar);
            border-radius: 1vw;
            position:fixed;
            left: 50%;
            top: 50%;
            display: flex;
            flex-direction: column;
            align-items: center; 
            transform: translate(-50%,-50%);
            transition: all 0.1s ease;
            font-family: comfortaa , sans-serif;
        }
        .logininput{
            flex: 0 1 auto;
            height: 2vw;
            font-size: 1vw;
            width: 20vw;
            background-color: var(--input-bg);
            border: none;
            color: var(--text-color);
            padding: 0.3vw 0.5vw;
            outline: none;
            border-radius: 0.2vw;
            margin-top: 0.4vw;
            margin-bottom: 0.4vw;
        }
        .login-bt {
            background-color: var(--accent-color);
            border: none;
            padding: 0.6vw;
            margin: 0.4vw;
            width: 21vw;
            color: #fff;
            cursor: pointer;
            border-radius: 0.2vw;
            font-size: 1vw;
        }

        .login-bt:hover {
            opacity: 0.9;
        }
        .loginerrorpopup {
            height: 2vw;
            width: 20vw;
            border-radius: 0.2vw;
            position: absolute;
            text-align: center;
            background-color: #3baa56;
            font-size: 1vw;
            left: 40vw;
        }
        .ErrorPopupShow{
            animation: ErrorPopupShow ease-out 0.15s forwards;
        }
        @keyframes ErrorPopupShow {
            0% {
                top: 100vh;
            }
            100% {
                top: 95vh;
            }
        }
        .ErrorPopupHide{
            animation: ErrorPopupHide ease-out 0.15s forwards;
        }
        @keyframes ErrorPopupHide {
            0% {
                top: 95vh;
            }
            100% {
                top: 100vh;
            }
        } 
    </style>
</head>
<body>
    <div class="maincontent" id="maincontent">
        
    </div>
    <div class="bg"></div>
    <div class="overlay"></div>
    <div class="AddServerPopup" id="AddServerPopup"> 
        <span class="popuptext" style="margin-bottom: 0.4vw; margin-top: 0.8vw; font-weight: bold;">Join a group</span>
        <span class="popuptext" style="margin-bottom: 1vw; margin-left: 0.5vw; margin-right: 0.5vw;font-weight:100; font-size: 1vw; text-align: center;">
            Input a group id and then you can chat with your buddys
        </span>
        <input class="custominput" placeholder="Enter URL here" id="joingroupid"></input>
        <button class="content-bt" onclick='joinGroup(document.getElementById("joingroupid").value)'>Join</button>
        <span class="popuptext"  style="margin-bottom: 2vw; margin-left: 0.5vw; margin-right: 0.5vw;margin-top: 1vw; font-weight:100; font-size: 1vw; text-align: center;">Or</span>
        <span class="popuptext" style="margin-bottom: 1vw; margin-left: 0.5vw; margin-right: 0.5vw;font-weight:100; font-size: 1vw; text-align: center;">
            Make a group
        </span>
        <input class="custominput" placeholder="Enter Group name here" id="creategroupname"></input>
        <button class="content-bt" onclick='createGroup(document.getElementById("creategroupname").value)'>Create</button>
    </div>
    <script>
        let socket = null;
        let username = null;
        let myuuid = customUuid();
        let currentGroup = null;

        ConnectToServer();
        function InitLogin(){
                const maincontainer = document.getElementById("maincontent");
                maincontainer.classList.add("smoothhide");
                maincontainer.addEventListener("animationend", function handleAnimationEnd() {
                    maincontainer.classList.remove("smoothhide");
                    maincontainer.classList.add("smoothshow");
                    maincontainer.removeEventListener("animationend", handleAnimationEnd);
                    maincontainer.innerHTML = `
                        <div class="LoginBox" id="loginbox"> 
                            <span style="font-size:2vw; text-align: center; width: 20vw; margin-top: 1vw;">Login</span>
                            <span style="font-size:1vw; text-align: center; width: 20vw; margin-top: 0.5vw; margin-bottom:0.5vw">Login to start chatting with your buddies</span>
                            <span style="font-size:0.8vw; text-align: left; width: 20vw;">Username<code style="color:red">*</code></span>
                            <input id="login-username" class="logininput" placeholder="Enter Username here"></input>
                            <span style="font-size:0.8vw; text-align: left; width: 20vw;">Password<code style="color:red">*</code></span>
                            <input id="login-password" class="logininput" type="password" placeholder="Enter Password here"></input>
                            <button class="login-bt" onclick="Login()">Login</button>
                            <span style="font-size:0.8vw; text-align: left; width: 20vw;">Don't have an account? <a style="color:lightblue;" href="#" onclick="InitRegister()">Register</a></span>
                        </div>
                    `;
                });
            }

            
        function InitRegister(){
                const maincontainer = document.getElementById("maincontent");
                maincontainer.classList.add("smoothhide");
                maincontainer.addEventListener("animationend", function handleAnimationEnd() {
                    maincontainer.classList.remove("smoothhide");
                    maincontainer.classList.add("smoothshow");
                    maincontainer.removeEventListener("animationend", handleAnimationEnd);
                    maincontainer.innerHTML = `
                        <div class="LoginBox"> 
                            <span style="font-size:2vw; text-align: center; width: 20vw; margin-top: 1vw;">Register</span>
                            <span style="font-size:1vw; text-align: center; width: 20vw; margin-top: 0.5vw; margin-bottom:0.5vw">Register to start chatting with your buddies</span>
                            <span style="font-size:0.8vw; text-align: left; width: 20vw;">Username<code style="color:red">*</code></span>
                            <input id="register-username" class="logininput" placeholder="Enter Username here"></input>
                            <span style="font-size:0.8vw; text-align: left; width: 20vw;">Password<code style="color:red">*</code></span>
                            <input id="register-password" class="logininput" type="password" placeholder="Enter Password here"></input>
                            <button class="login-bt" onclick="Register()">Register</button>
                            <span style="font-size:0.8vw; text-align: left; width: 20vw;">Already have an account? <a style="color:lightblue;" href="#" onclick="InitLogin()">Login</a></span>
                        </div>
                    `;
                });
            }

        function InitChat(){
            const maincontainer = document.getElementById("maincontent");
            maincontainer.classList.add("smoothhide");
            maincontainer.addEventListener("animationend", function handleAnimationEnd() {
                maincontainer.classList.remove("smoothhide");
                maincontainer.classList.add("smoothshow");
                maincontainer.removeEventListener("animationend", handleAnimationEnd);
                maincontainer.innerHTML = `
                <div class="leftsidecontent" id="leftsidecontent">
                    <div class="server-icon-container" id="AddGroup">
                        <img src="/assets/img/roundAddIcon.png" class="leftsidecontent-icon" style="width: 95%; height: 95%;">
                    </div>
                </div>
                <div class="chatcontent">
                    <div id="content" class="content"></div>
                    <div class="bottombar">
                        <input class="textinput" id="textinput" placeholder="Enter something to text"></input>
                    </div>
                </div>
                <div class="rightsidecontent" id="rightsidecontent"></div>
                `;
                loadData();
                ConnectToServer();
                InitInput()
            });
        }
        InitLogin();
        function handleOverlayAnimationEnd() {
            const overlay = document.querySelector(".overlay");
            overlay.style.display = "none";
            overlay.removeEventListener("animationend", handleOverlayAnimationEnd);
        }
        function addServerPopup(){
            const popup = document.getElementById("AddServerPopup");
            const overlay = document.querySelector(".overlay");
            popup.style.display = "flex";
            popup.classList.remove("smoothhide");
            popup.classList.add("smoothshow");
            overlay.style.display = "block";
            overlay.classList.remove("HideOverlayAnim");
            overlay.classList.add("ShowOverlayAnim");
            popup.querySelectorAll("input").forEach((key) =>{
                key.disabled = false;
            })
        }
        function closeServerPopup(){
            const popup = document.getElementById("AddServerPopup");
            const overlay = document.querySelector(".overlay");
            popup.classList.remove("smoothshow");
            popup.classList.add("smoothhide");
            overlay.classList.remove("ShowOverlayAnim");
            overlay.classList.add("HideOverlayAnim");
            overlay.addEventListener("animationend", handleOverlayAnimationEnd);
            popup.querySelectorAll("input").forEach((key) =>{
                key.disabled = true;
            })
        }
        function initServerContent(){
            const popup = document.createElement("div");
            popup.classList.add("popup");
            popup.textContent = "Add Group";
            document.body.appendChild(popup);

            const container = document.getElementById("AddGroup");
            container.addEventListener("mouseover", () => {
                const rect = container.getBoundingClientRect();
                popup.style.display = "block";
                const viewportWidth = window.innerWidth;
                const leftInVW = (rect.left + window.scrollX) / viewportWidth * 100;
                popup.style.left = `${leftInVW + 4}vw`; 
                popup.style.top = `${rect.top + window.scrollY}px`;
            });
            container.addEventListener("click",() => {
                addServerPopup();
            });
            container.addEventListener("mouseout", () => {
                popup.style.display = "none";
            });
        }

        function makebox(text, name, isself, iconurl) {
            const container = document.createElement("div");
            container.style.display = "flex";
            container.style.flexDirection = "column";
            container.style.alignItems = isself ? "flex-end" : "flex-start"; 

            const textdiv = document.createElement("span");
            textdiv.classList.add("textbox-name");
            textdiv.innerText = name;

            const box = document.createElement("div");
            box.classList.add("textbox");
            box.innerText = text;
            box.style.width = "auto";
            box.style.textAlign = "left";

            const userinfocontainer = document.createElement("div");
            userinfocontainer.classList.add("userinfo-container");

            const iconcontainer = document.createElement("div");
            iconcontainer.classList.add("usericon-container");

            const icon = document.createElement("img");
            icon.src = iconurl;
            icon.style.width = "90%";
            icon.style.height = "90%";
            icon.classList.add("usericon-icon");
            iconcontainer.appendChild(icon);

            if (isself){
                userinfocontainer.appendChild(iconcontainer);
                userinfocontainer.appendChild(textdiv);
            } else {
                userinfocontainer.appendChild(textdiv);
                userinfocontainer.appendChild(iconcontainer);
            }

            container.appendChild(userinfocontainer);
            container.appendChild(box);
            document.getElementById("content").appendChild(container);
            document.getElementById("content").scrollTop = document.getElementById("content").scrollHeight;
        }

        function makeServer(name, iconurl, id) {
            const container = document.createElement("div");
            container.classList.add("leftsidecontent-icon-container");

            const icon = document.createElement("img");
            icon.src = iconurl;
            icon.style.width = "90%";
            icon.style.height = "90%";
            icon.classList.add("leftsidecontent-icon");
            container.appendChild(icon);
            document.getElementById("leftsidecontent").insertBefore(container, document.getElementById("AddGroup"));

            const popup = document.createElement("div");
            popup.classList.add("popup");
            popup.textContent = name;
            document.body.appendChild(popup);

            container.addEventListener("mouseover", () => {
                const rect = container.getBoundingClientRect();
                popup.style.display = "block";
                const viewportWidth = window.innerWidth;
                const leftInVW = (rect.left + window.scrollX) / viewportWidth * 100;
                popup.style.left = `${leftInVW + 4}vw`; 
                popup.style.top = `${rect.top + window.scrollY}px`;
            });
            container.addEventListener("mouseout", () => {
                popup.style.display = "none";
            });

            container.addEventListener("click", () => {
                currentGroup = id;
                const packet = {
                    type: "requestGroupMessages",
                    groupID: id,
                    userID: myuuid
                };
                socket.send(JSON.stringify(packet));
            });
        }

        function makeUser(name, iconurl) {
            const container = document.createElement("div");
            container.style.display = "flex";
            container.style.flexDirection = "row";
            container.style.alignItems = "center";

            container.style.marginBottom = "0.5vw";
            container.style.height = "3vw";
            container.style.width = "95%";

            const iconcontainer = document.createElement("div");
            iconcontainer.classList.add("usericon-container");
            iconcontainer.style.display = "flex";
            iconcontainer.style.alignItems = "center";
            iconcontainer.style.justifyContent = "center";
            iconcontainer.style.width = "2.5vw";
            iconcontainer.style.height = "2.5vw";
            iconcontainer.style.marginRight = "1vw";

            const icon = document.createElement("img");
            icon.src = iconurl;
            icon.style.width = "90%";
            icon.style.height = "90%";
            icon.style.objectFit = "cover";

            iconcontainer.appendChild(icon);
            container.appendChild(iconcontainer);

            const nameDiv = document.createElement("div");
            nameDiv.style.fontSize = "0.8vw";
            nameDiv.style.fontWeight = "bold";
            nameDiv.innerText = name;

            container.appendChild(nameDiv);

            document.getElementById("rightsidecontent").appendChild(container);
        }
        function MakeErrorMessage(loginerr,success) {
            const loginerror = document.createElement("div");
            if (!success){
                loginerror.style.background = "#ff3535d2";
            }
            loginerror.classList.add("loginerrorpopup", "ErrorPopupShow");
            loginerror.innerText = loginerr;
            document.body.appendChild(loginerror);

            loginerror.addEventListener("animationend", function handleAnimationEnd() {
                if (loginerror.classList.contains("ErrorPopupShow")) {
                    setTimeout(() =>{
                        loginerror.classList.remove("ErrorPopupShow");
                    loginerror.classList.add("ErrorPopupHide");
                    }, 2000);
                } else if (loginerror.classList.contains("ErrorPopupHide")) {
                    loginerror.remove();
                    loginerror.removeEventListener("animationend", handleAnimationEnd);
                }
            });
        }

        function Login() {
            const username = document.getElementById("login-username").value.trim();
            const password = document.getElementById("login-password").value.trim();
            if (username && password) {
                const payload = {
                    type: "login",
                    data: { username, password,myuuid}
                };
                socket.send(JSON.stringify(payload));
            } else {
                MakeErrorMessage("Please fill out all fields")
            }
        }
    
        function Register() {
            const username = document.getElementById("register-username").value.trim();
            const password = document.getElementById("register-password").value.trim();

            if (username && password) {
                console.log(myuuid)
                const payload = {
                    type: "create_account",
                    uuid: myuuid,
                    data: { username, password }
                };
                socket.send(JSON.stringify(payload));
            } else {
                MakeErrorMessage("Please fill out all fields")
            }
        }
        function InitInput(){
            textinput = document.getElementById("textinput");
            textinput.addEventListener("keydown", (e) => {
                if (e.key === "Enter" && textinput.value !== "" && socket) {
                    const date = new Date();
                    const messagevalue = textinput.value;
                    const jsonpayload = {
                        type: "sendmessage",
                        group: currentGroup,
                        userID: myuuid,
                        message: messagevalue,
                        name: username,
                        time: date.getHours() + ":" + String(date.getMinutes()).padStart(2, "0")
                    };
                    socket.send(JSON.stringify(jsonpayload));
                    textinput.value = "";
                }
            });
        }
        function customUuid(length = 200) {
            const randomValues = crypto.getRandomValues(new Uint8Array(length));
            return Array.from(randomValues, (byte) => byte.toString(16).padStart(2, "0")).join("");
        }

        function genClientKey() {
            const randomBytes = new Uint8Array(128);
            window.crypto.getRandomValues(randomBytes);
            const base64String = btoa(String.fromCharCode.apply(null, randomBytes));
            return base64String
        }
        function loadData(){
            makeUser("Thatoneham", "/assets/img/user.svg");
            makeUser("YourSeriousDev", "/assets/img/user.svg");
        }
        function joinGroup(id){
            closeServerPopup();
            const packet = {
                type: "joingroup",
                id: id,
                userID: myuuid,
                username: username
            };
            socket.send(JSON.stringify(packet));
        }
        function createGroup(name){
            closeServerPopup();
            const packet = {
                type: "makegroup",
                servername: name,
                userID: myuuid,
                username: username
            };
            console.log(myuuid);
            socket.send(JSON.stringify(packet));
        }
        function UpdateServerList(groups) {
        function waitForElement() {
                const leftSideContent = document.getElementById("leftsidecontent");
                if (leftSideContent) {
                    clearInterval(checkInterval); 

                    leftSideContent.innerHTML = `
                        <div class="server-icon-container" id="AddGroup">
                            <img src="/assets/img/roundAddIcon.png" class="leftsidecontent-icon" style="width: 95%; height: 95%;">
                        </div>
                    `;

                    initServerContent();

                    groups.forEach((group) => {
                        makeServer(group.name, group.icon, group.id);
                    });
                }
            }
            const checkInterval = setInterval(waitForElement, 100);
        }
        function sendGroupPacket(username) {
            myuuid = customUuid();
            const packet = {
                type: "GetUserGroupList",
                username: username,
                userID: myuuid,
            };
            socket.send(JSON.stringify(packet));
        }

        function ConnectToServer() {
            socket = new WebSocket("ws://localhost:9001");

            socket.addEventListener("message", (event) => {
                try {
                    
                    const data = JSON.parse(event.data);
                    console.log(data.type)
                    console.log(data.status)
                    console.log(data.message)
                    console.log("server uuid is: "+ data.userID)
                    console.log("my uuid is: "+ myuuid)
                    console.log(data.userID == myuuid)
                    if (data.status !== "error") {
                        if (data && data.userID === myuuid) {
                            myuuid = customUuid();
                            switch (data.type) {
                                case "Login":
                                    InitChat();
                                    username = data.username;
                                    sendGroupPacket(username);
                                    MakeErrorMessage(data.message, true);
                                    break;

                                case "CreateAccount":
                                    MakeErrorMessage(data.message, true);
                                    break;

                                case "MakeGroup":
                                    MakeErrorMessage(data.message, true);
                                    sendGroupPacket(username);
                                    console.log("group id is " + data.groupid);
                                    navigator.clipboard.writeText(data.groupid);
                                    break;

                                case "JoinGroup":
                                    MakeErrorMessage(data.message, true);
                                    sendGroupPacket(username);
                                    break;

                                case "SendMessage":
                                    makebox(
                                        data.message,
                                        data.name + " " + data.time,
                                        false,
                                        "/assets/img/user.svg"
                                    );
                                    document.getElementById("content").scrollTop = document.getElementById("content").scrollHeight;
                                    break;

                                case "groupMessages":
                                    document.getElementById("content").innerHTML = "";
                                    data.messages.forEach((msg) => {
                                        makebox(
                                            msg.message,
                                            msg.name + " " + msg.time,
                                            false,
                                            "/assets/img/user.svg"
                                        );
                                    });
                                    break;

                                case "getGroupList":
                                    UpdateServerList(data.groups);
                                    break;

                                default:
                                    console.log("Unhandled message type:", data.type);
                                    break;
                            }
                        }
                    } else {
                        MakeErrorMessage(data.message, false);
                    }
                } catch (e) {
                    console.error("Failed to process message. Error:", e);
                }
            });

            socket.addEventListener("error", (error) => {
                console.error("WebSocket error:", error);
            });

            socket.addEventListener("close", () => {
                console.log("WebSocket connection closed");
            });

        }
        let forlater = `
        if (data && data.userID !== myuuid) {
            makebox(
                data.message,
                data.name + " " + data.time,
                false,
                "/assets/img/user.svg"
            );
        }
        `;
    </script>
</body>
</html>
